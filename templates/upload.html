{% extends "base.html" %}

{% block title %}Upload File - Secure File Exchange{% endblock %}

{% block content %}
<div class="row justify-content-center mt-4">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-upload"></i> Upload & Enkripsi File</h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label for="file" class="form-label">
                            <i class="fas fa-file"></i> Pilih File
                        </label>
                        <input type="file" class="form-control" id="file" name="file" required 
                               accept=".xlsx,.xls,.jpg,.jpeg,.png,.pdf">
                        <div class="form-text">
                            Format yang didukung: Excel (.xlsx, .xls), Gambar (.jpg, .png), PDF (.pdf)
                            <br>Ukuran maksimal: 16 MB
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="algorithm" class="form-label">
                            <i class="fas fa-shield-alt"></i> Pilih Algoritma Enkripsi
                        </label>
                        <select class="form-select" id="algorithm" name="algorithm" required>
                            <option value="AES" selected>AES-256 (Paling Aman)</option>
                            <option value="DES">DES (Cepat, Kurang Aman)</option>
                            <option value="RC4">RC4 (Stream Cipher)</option>
                        </select>
                    </div>
                    
                    <div class="mb-4" id="mode-section">
                        <label for="mode" class="form-label">
                            <i class="fas fa-cog"></i> Mode Operasi
                        </label>
                        <select class="form-select" id="mode" name="mode" required>
                            <option value="CBC" selected>CBC (Cipher Block Chaining)</option>
                            <option value="CTR">CTR (Counter)</option>
                            <option value="CFB">CFB (Cipher Feedback)</option>
                            <option value="OFB">OFB (Output Feedback)</option>
                        </select>
                        <div class="form-text">
                            Mode operasi menentukan bagaimana blok data dienkripsi
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> <strong>Informasi:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>AES-256:</strong> Standar enkripsi modern, sangat aman dan cepat</li>
                            <li><strong>DES:</strong> Algoritma lama, cocok untuk pembelajaran dan perbandingan</li>
                            <li><strong>RC4:</strong> Stream cipher yang cepat, tidak menggunakan mode operasi</li>
                        </ul>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-custom btn-lg">
                            <i class="fas fa-lock"></i> Enkripsi & Upload
                        </button>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-custom">
                            <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-question-circle"></i> Cara Kerja</h5>
                <ol>
                    <li>Pilih file yang ingin Anda enkripsi</li>
                    <li>Pilih algoritma enkripsi (AES, DES, atau RC4)</li>
                    <li>Untuk AES dan DES, pilih mode operasi yang diinginkan</li>
                    <li>Klik tombol "Enkripsi & Upload"</li>
                    <li>File akan dienkripsi secara otomatis dan disimpan dengan aman</li>
                    <li>Anda dapat mengunduh dan mendekripsi file kapan saja dari Dashboard</li>
                </ol>
                <div class="alert alert-warning mb-0">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <strong>Penting:</strong> Kunci enkripsi disimpan bersama file terenkripsi. 
                    Di aplikasi produksi, sebaiknya kunci disimpan terpisah untuk keamanan lebih baik.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('algorithm').addEventListener('change', function() {
        const modeSection = document.getElementById('mode-section');
        const modeSelect = document.getElementById('mode');
        
        if (this.value === 'RC4') {
            modeSection.style.display = 'none';
            modeSelect.required = false;
        } else {
            modeSection.style.display = 'block';
            modeSelect.required = true;
            
            // Update opsi mode berdasarkan algoritma
            if (this.value === 'DES') {
                modeSelect.innerHTML = `
                    <option value="CBC" selected>CBC (Cipher Block Chaining)</option>
                    <option value="CFB">CFB (Cipher Feedback)</option>
                    <option value="OFB">OFB (Output Feedback)</option>
                `;
            } else { // AES
                modeSelect.innerHTML = `
                    <option value="CBC" selected>CBC (Cipher Block Chaining)</option>
                    <option value="CTR">CTR (Counter)</option>
                    <option value="CFB">CFB (Cipher Feedback)</option>
                    <option value="OFB">OFB (Output Feedback)</option>
                `;
            }
        }
    });
    
    // Validasi ukuran file
    document.getElementById('file').addEventListener('change', function() {
        const fileSize = this.files[0].size / 1024 / 1024; // MB
        if (fileSize > 16) {
            alert('Ukuran file terlalu besar! Maksimal 16 MB');
            this.value = '';
        }
    });
</script>
{% endblock %}